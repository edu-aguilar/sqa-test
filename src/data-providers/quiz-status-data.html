<link rel="import" href="../../bower_components/polymer/polymer-element.html">

<dom-module id="quiz-status-data">

  <script>
  (function() {
    let quizStatusData = {
      answeredQuestions: {}
    };

    let subscribers = [];

    class QuizStatusData extends Polymer.Element {
      static get is() { return 'quiz-status-data'; }
      
      static get properties() { 
        return {
          totalQuestions: Number,
          answeredQuestions: {
            type: Object,
            notify: true,
            value: () => quizStatusData.answeredQuestions
          },
          progress: {
            type: Number,
            notify: true,
            computed: '_computeProgress(answeredQuestions.*, totalQuestions)'
          },
          answeredQuestionsCount: {
            type: Number,
            notify: true
          }
        }
      }

      constructor() {
        super();
        subscribers.push(this);
      }

      disconnectedCallback() {
        super.disconnectedCallback();
        subscribers.splice(subscribers.indexOf(this), 1);
      }

      setAnsweredQuestion(questionId, answerId){
        quizStatusData.answeredQuestions[questionId] = answerId;
        this.__updateSuscribers(`answeredQuestions.${questionId}`);
      }

      _computeProgress(){
        this.answeredQuestionsCount = Object.keys(this.answeredQuestions).length;
        return this.answeredQuestionsCount / this.totalQuestions * 100;
      }

      __updateSuscribers(path) {
        subscribers.forEach((suscriber) => { suscriber.notifyPath(path) });
      }
    }

    customElements.define(QuizStatusData.is, QuizStatusData);
  })();
  </script>

</dom-module>