<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/shared-properties-mixin/shared-properties-mixin.html">


<dom-module id="quiz-data">
  <script>
    class QuizData extends SharedPropertiesMixin(Polymer.Element) {
      static get is() {return 'quiz-data';}
      static get properties() {
        return {
          data: {
            type: Object,
            notify: true,
            sharedStoreKey: 'quizDataStorage'
          },
          profile: {
            type: String,
            observer: '_loadData'
          }
        };
      }

      _loadData() {
        /*
          TODO: we need to know if the stored profile is different to the current,
          maybe with an additional key in the JSON or storing quizID for comparison
        */
        if (this.profile && !this.data) {
          this.loadFromJson();
        }
      }

      loadFromJson() {
        let url = `data/${this.profile}.json`;
        fetch(url)
        .then((resp) => resp.json())
        .then((data) => {
          this.set('data', data);
        })
        .catch((e) => {this._notifyError(e);});
      }

      _notifyError(err) {
        let event = new CustomEvent(
          'onRouteChange',
          {
            detail: { newRoute: 'not-found' },
            composed: true
          }
        );
        this.dispatchEvent(event);
      }
    }

    customElements.define(QuizData.is, QuizData);
  </script>
</dom-module>
